environment:
  name: document-generation
  location: eastus

name: document-generation
metadata:
  template: document-generation@1.0

requiredVersions:
  azd: '>= 1.18.0'

parameters:
  solutionPrefix:
    type: string
    default: bs-azdtest  
  otherLocation:
    type: string
    default: eastus2
  baseUrl:
    type: string
    default: 'https://github.com/microsoft/document-generation-solution-accelerator'

services:
   webapp:
    project: ./src
    language: py
    host: appservice
    dist: ./dist
    hooks:
      prepackage:
        windows:
          shell: pwsh
          run: ../infra/scripts/package_webapp.ps1
          interactive: true
          continueOnError: false
        posix:
          shell: sh
          run: bash ../infra/scripts/package_webapp.sh
          interactive: true
          continueOnError: false

deployment:
  mode: Incremental
  template: ./infra/main.bicep  # Path to the main.bicep file inside the 'deployment' folder
  parameters:
    solutionPrefix: ${parameters.solutionPrefix}
    otherLocation: ${parameters.otherLocation}
    baseUrl: ${parameters.baseUrl}

# hooks:
  # postprovision:
  #   windows:
  #     run: |
  #       ./scripts/auth_update.ps1
  #       Write-Host "`nBuilding and pushing Docker image to ACR..." -ForegroundColor Yellow
  #       ./scripts/build-push-acr.ps1
  #       Write-Host "`nWeb app URL: "
  #       Write-Host "$env:WEB_APP_URL" -ForegroundColor Cyan
  #       Write-Host "`nIf you want to use the Sample Data, run the following command in the Bash terminal to process it:"
  #       Write-Host "bash ./infra/scripts/process_sample_data.sh" -ForegroundColor Cyan
  #     shell: pwsh
  #     continueOnError: false
  #     interactive: true
  #   posix:
  #     run: |
  #       ./scripts/auth_update.sh
  #       echo ""
  #       echo "Building and pushing Docker image to ACR..."
  #       bash ./scripts/build-push-acr.sh
  #       echo ""
  #       echo "Web app URL: "
  #       echo $WEB_APP_URL
  #       echo ""
  #       echo "If you want to use the Sample Data, run the following command in the bash terminal to process it:"
  #       echo "bash ./infra/scripts/process_sample_data.sh"
  #     shell: sh
  #     continueOnError: false
  #     interactive: true