environment:
  name: document-generation
  location: eastus

name: document-generation
metadata:
  template: document-generation@1.0

requiredVersions:
  azd: '>= 1.18.0'

parameters:
  solutionPrefix:
    type: string
    default: bs-azdtest  
  otherLocation:
    type: string
    default: eastus2
  baseUrl:
    type: string
    default: 'https://github.com/microsoft/document-generation-solution-accelerator'

deployment:
  mode: Incremental
  template: ./infra/main.bicep  # Path to the main.bicep file inside the 'deployment' folder
  parameters:
    solutionPrefix: ${parameters.solutionPrefix}
    otherLocation: ${parameters.otherLocation}
    baseUrl: ${parameters.baseUrl}

hooks:
  postprovision:
    windows:
      run: |
        Write-Host "Web app URL: "
        Write-Host "$env:WEB_APP_URL" -ForegroundColor Cyan
        Write-Host "`nCreate and activate a virtual environment if not already done, then run the following command in your Bash terminal to create agents:"
        Write-Host "bash ./infra/scripts/agent_scripts/run_create_agents_scripts.sh" -ForegroundColor Cyan
        Write-Host "`nRun the following command in the bash terminal. It will grant the necessary permissions between resources and your user account, and also process and load the sample data into the application."
        Write-Host "bash ./infra/scripts/process_sample_data.sh" -ForegroundColor Cyan
      shell: pwsh
      continueOnError: false
      interactive: true
    posix:
      run: |
        echo "Web app URL: "
        echo $WEB_APP_URL
        echo ""
        echo "Create and activate a virtual environment if not already done, then run the following command in your Bash terminal to create agents:"
        echo "bash ./infra/scripts/agent_scripts/run_create_agents_scripts.sh"
        echo ""
        echo "Run the following command in the bash terminal. It will grant the necessary permissions between resources and your user account, and also process and load the sample data into the application."
        echo "bash ./infra/scripts/process_sample_data.sh"
      shell: sh
      continueOnError: false
      interactive: true